{% comment %}
  Clean chapter navigation for series pages
  Reads from _data/series.yml to determine prev/next chapters
{% endcomment %}

{% if site.data.series %}
  {% assign current_series = nil %}
  {% assign current_index = nil %}

  {% for series in site.data.series %}
    {% for chapter in series.chapters %}
      {% assign chapter_url = '/pages/' | append: chapter.slug %}
      {% if page.url contains chapter.slug %}
        {% assign current_series = series %}
        {% assign current_index = forloop.index0 %}
        {% break %}
      {% endif %}
    {% endfor %}
    {% if current_series %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if current_series %}
    <nav class="chapter-navigation">
      <div class="chapter-nav-inner">
        <!-- Previous -->
        <div class="chapter-nav-item prev">
          {% if current_index > 0 %}
            {% assign prev_index = current_index | minus: 1 %}
            {% assign prev = current_series.chapters[prev_index] %}
            <a href="/pages/{{ prev.slug }}" class="chapter-nav-link">
              <span class="nav-label">Previous</span>
              <span class="nav-title">{{ prev.title }}</span>
            </a>
          {% else %}
            <a href="{{ current_series.main }}" class="chapter-nav-link home">
              <span class="nav-label">Series Home</span>
              <span class="nav-title">{{ current_series.title }}</span>
            </a>
          {% endif %}
        </div>

        <!-- Progress -->
        <div class="chapter-progress">
          <span class="progress-text">Chapter {{ current_index | plus: 1 }} of {{ current_series.chapters.size }}</span>
          <div class="progress-bar">
            <div class="progress-fill" style="width: {{ current_index | plus: 1 | times: 100 | divided_by: current_series.chapters.size }}%"></div>
          </div>
        </div>

        <!-- Next -->
        <div class="chapter-nav-item next">
          {% assign next_index = current_index | plus: 1 %}
          {% if next_index < current_series.chapters.size %}
            {% assign next = current_series.chapters[next_index] %}
            <a href="/pages/{{ next.slug }}" class="chapter-nav-link">
              <span class="nav-label">Next</span>
              <span class="nav-title">{{ next.title }}</span>
            </a>
          {% else %}
            <div class="chapter-complete">
              <span class="complete-icon">âœ“</span>
              <span class="complete-text">Series Complete</span>
            </div>
          {% endif %}
        </div>
      </div>
    </nav>
  {% endif %}
{% endif %}
