{% comment %}
  Auto-generate chapter navigation for series pages
  Reads from _data/series.yml to determine prev/next chapters
{% endcomment %}

{% if site.data.series %}
  {% assign current_series = nil %}
  {% assign current_index = nil %}

  {% for series in site.data.series %}
    {% for chapter in series.chapters %}
      {% assign chapter_url = '/pages/' | append: chapter.slug %}
      {% if page.url contains chapter.slug %}
        {% assign current_series = series %}
        {% assign current_index = forloop.index0 %}
        {% break %}
      {% endif %}
    {% endfor %}
    {% if current_series %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if current_series %}
    <nav class="flex items-center justify-between py-6 mt-12 border-t-2 border-amber-200">
      <div class="flex-1">
        {% if current_index > 0 %}
          {% assign prev_index = current_index | minus: 1 %}
          {% assign prev = current_series.chapters[prev_index] %}
          <a href="/pages/{{ prev.slug }}" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all shadow-sm hover:shadow-md">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <span class="hidden sm:inline">{{ prev.title }}</span>
            <span class="sm:hidden">Previous</span>
          </a>
        {% else %}
          <a href="{{ current_series.main }}" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-lg hover:from-amber-600 hover:to-amber-700 transition-all shadow-sm hover:shadow-md">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
            </svg>
            <span>Series Home</span>
          </a>
        {% endif %}
      </div>

      <div class="flex-shrink-0 px-4 text-center">
        <span class="text-xs text-gray-500 font-medium">
          Chapter {{ current_index | plus: 1 }} of {{ current_series.chapters.size }}
        </span>
      </div>

      <div class="flex-1 text-right">
        {% assign next_index = current_index | plus: 1 %}
        {% if next_index < current_series.chapters.size %}
          {% assign next = current_series.chapters[next_index] %}
          <a href="/pages/{{ next.slug }}" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all shadow-sm hover:shadow-md">
            <span class="hidden sm:inline">{{ next.title }}</span>
            <span class="sm:hidden">Next</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        {% endif %}
      </div>
    </nav>
  {% endif %}
{% endif %}
